<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FixMySchool â€“ Report Broken Infrastructure</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <header>
    <h1>FixMySchool</h1>
    <p>Highlight and report poor school infrastructure</p>
    <nav>
      <a href="/report.html">Submit a Report</a>
    </nav>
  </header>

  <main>
    <section id="gallery">
      <h2>Recent Approved Reports</h2>
      <div id="reportContainer">Loading reports...</div>
    </section>
  </main>

  <footer>
    <nav>
      <a href="/about.html">About</a> |
      <a href="/contact.html">Contact</a> |
      <a href="/privacy.html">Privacy Policy</a>
    </nav>
    <p>&copy; 2025 FixMySchool</p>
  </footer>

  <script>
    async function loadReports() {
      const container = document.getElementById("reportContainer");
      try {
        const res = await fetch("https://fixmyschool-api.mtndatasales.workers.dev/reports");
        const data = await res.json();
        const reports = data.reports;

        if (!reports.length) {
          container.innerHTML = "<p>No approved reports yet.</p>";
          return;
        }

        // Group reports by date
        const grouped = {};
        for (const r of reports) {
          const date = new Date(r.timestamp).toDateString();
          if (!grouped[date]) grouped[date] = [];
          grouped[date].push(r);
        }

        container.innerHTML = "";

        for (const [date, entries] of Object.entries(grouped)) {
          const group = document.createElement("div");
          group.className = "report-group";
          const heading = document.createElement("h3");
          heading.textContent = date;
          group.appendChild(heading);

          const scrollArea = document.createElement("div");
          scrollArea.className = "scroll-row";

          entries.forEach(entry => {
            const box = document.createElement("div");
            box.className = "report-box";

            const img = document.createElement("img");
            img.src = entry.photoUrls?.[0] || "";
            img.alt = entry.school;

            const info = document.createElement("div");
            info.innerHTML = `
              <strong>${entry.school}</strong><br />
              ${entry.location}<br />
              <small>${entry.issue}</small>
            `;

            box.appendChild(img);
            box.appendChild(info);
            scrollArea.appendChild(box);
          });

          group.appendChild(scrollArea);
          container.appendChild(group);
        }

      } catch (err) {
        container.innerHTML = "<p>Error loading reports. Try again later.</p>";
        console.error(err);
      }
    }

    document.addEventListener("DOMContentLoaded", loadReports);
  </script>
</body>
</html>
