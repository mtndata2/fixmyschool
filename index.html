<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FixMySchool â€“ Reported Infrastructure Issues</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>

  <div class="top-bar">
    <div>ðŸ“¸ <strong>FixMySchool</strong></div>
    <div>
      <a href="/report.html">Submit a Report</a>
      <a href="/about.html">About</a>
      <a href="/contact.html">Contact</a>
    </div>
  </div>

  <div class="content-wrapper">
    <h2>Approved School Infrastructure Issues</h2>
    <p>Below are recent reports approved by moderators, grouped by date:</p>

    <div id="gallery-container"></div>
  </div>

  <script>
    function formatDateGroup(iso) {
      const d = new Date(iso);
      return d.toLocaleDateString(undefined, {
        weekday: 'short',
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });
    }

    fetch('https://fixmyschool-api.mtndatasales.workers.dev/reports')
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById('gallery-container');
        const grouped = {};

        data.reports.forEach(report => {
          const dateKey = formatDateGroup(report.timestamp);
          if (!grouped[dateKey]) grouped[dateKey] = [];
          grouped[dateKey].push(report);
        });

        Object.keys(grouped).sort((a, b) => new Date(b) - new Date(a)).forEach(date => {
          const section = document.createElement('div');
          section.className = 'date-section';

          const heading = document.createElement('div');
          heading.className = 'date-heading';
          heading.textContent = date;
          section.appendChild(heading);

          const row = document.createElement('div');
          row.className = 'gallery-row';

          grouped[date].forEach(report => {
            const div = document.createElement('div');
            div.className = 'gallery-card';

            const imageUrl = report.photoUrls[0] || '';
            const slug = encodeURIComponent(report.id.replace('/report.json', ''));

            div.innerHTML = `
              <a href="/entry/${slug}.html">
                <img src="${imageUrl}" alt="Preview">
              </a>
              <p><strong>${report.school}</strong><br>
              ${report.location}<br>
              <em>${report.issue}</em></p>
            `;
            row.appendChild(div);
          });

          section.appendChild(row);
          container.appendChild(section);
        });
      });
  </script>
</body>
</html>

