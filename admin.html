<script>
async function loadReports() {
  const res = await fetch("https://fixmyschool-api.mtndatasales.workers.dev/admin");
  const { reports } = await res.json();

  const container = document.getElementById("admin-list");
  container.innerHTML = "";

  reports.forEach((r, index) => {
    const item = document.createElement("div");
    item.className = "admin-card";
    item.innerHTML = `
      <p><strong>${r.school}</strong> - ${r.location}</p>
      <p>Issue: ${r.issue}</p>
      <p>Date: ${new Date(r.timestamp).toLocaleString()}</p>
      ${r.photoUrl ? `<img src="${r.photoUrl}" width="200"/>` : ""}
      <br>
      <button onclick="moderate('${r.key}', 'approved')">✅ Approve</button>
      <button onclick="moderate('${r.key}', 'rejected')">❌ Reject</button>
      <hr>
    `;
    container.appendChild(item);
  });
}

async function moderate(key, status) {
  const res = await fetch("https://fixmyschool-api.mtndatasales.workers.dev/moderate", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ key, status })
  });

  const result = await res.json();
  if (result.success) {
    alert(`${status.toUpperCase()} ✅`);
    loadReports();
  } else {
    alert("Failed to moderate");
  }
}

window.onload = loadReports;
</script>


