<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Submit a Report – FixMySchool</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <h1>Report an Issue</h1>
  <form id="report-form" enctype="multipart/form-data">
    <label>School Name:
      <input type="text" name="school" required />
    </label>

    <label>State:
      <select name="state" id="stateSelect" required>
        <option value="">Select a State</option>
      </select>
    </label>

    <label>Local Government:
      <select name="location" id="lgaSelect" required>
        <option value="">Select LGA</option>
      </select>
    </label>

    <label>Describe the Issue:
      <textarea name="issue" required></textarea>
    </label>

    <label>Upload 5–10 Photos:
      <input type="file" name="photo" id="photos" accept="image/*" multiple required />
    </label>

    <label>Upload 1 Video (optional):
      <input type="file" name="video" accept="video/*" />
    </label>

    <button type="submit">Submit Report</button>
  </form>

  <script>
    const statesAndLgas = {
      "Abia": ["Aba North", "Aba South", "Isiala Ngwa North", "Isiala Ngwa South", "Umuahia North", "Umuahia South"],
      "Adamawa": ["Demsa", "Fufore", "Girei", "Gombi", "Guyuk", "Lamurde"],
      "Lagos": ["Agege", "Alimosho", "Apapa", "Eti-Osa", "Ikeja", "Kosofe", "Surulere"],
      "Imo": ["Aboh Mbaise", "Ehime Mbano", "Ideato North", "Mbaitoli", "Owerri North", "Owerri West"],
      // Add more full states and LGAs as needed
    };

    const stateSelect = document.getElementById("stateSelect");
    const lgaSelect = document.getElementById("lgaSelect");

    for (const state in statesAndLgas) {
      const opt = document.createElement("option");
      opt.value = state;
      opt.textContent = state;
      stateSelect.appendChild(opt);
    }

    stateSelect.addEventListener("change", () => {
      const lgas = statesAndLgas[stateSelect.value] || [];
      lgaSelect.innerHTML = '<option value="">Select LGA</option>';
      lgas.forEach(lga => {
        const opt = document.createElement("option");
        opt.value = lga;
        opt.textContent = lga;
        lgaSelect.appendChild(opt);
      });
    });

    document.getElementById("report-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const form = e.target;
      const photos = document.getElementById("photos").files;

      if (photos.length < 5 || photos.length > 10) {
        alert("You must upload between 5 and 10 photos.");
        return;
      }

      const formData = new FormData();
      formData.append("school", form.school.value);
      formData.append("location", form.location.value);
      formData.append("issue", form.issue.value);

      Array.from(photos).forEach((file, i) => {
        formData.append("photo" + i, file);
      });

      if (form.video.files.length > 0) {
        formData.append("video", form.video.files[0]);
      }

      const res = await fetch("https://fixmyschool-api.mtndatasales.workers.dev/", {
        method: "POST",
        body: formData
      });

      if (res.ok) {
        alert("Report submitted successfully!");
        form.reset();
        lgaSelect.innerHTML = '<option value="">Select LGA</option>';
      } else {
        alert("Failed to submit. Try again.");
      }
    });
  </script>
</body>
</html>

